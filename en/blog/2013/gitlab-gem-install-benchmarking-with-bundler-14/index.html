<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
        <title>GitLab gem install benchmarking with bundler 1.4</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="-1" />
        <link rel="stylesheet" href="http://axilleas.me/theme/style/reset.css" type="text/css" />
        <link rel="stylesheet" href="http://axilleas.me/theme/style/screen.css" type="text/css" />
        <link rel="stylesheet" href="http://axilleas.me/theme/style/friendly.css" type="text/css" />
        <link rel="stylesheet" href="http://axilleas.me/theme/style/print.css" type="text/css" media="print" />
        <link href="http://axilleas.me/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Over the line RSS Feed" />
</head>
<body>
    <header id="main">
        <div class="container">
            <div class="logo">
                <p><a href="/" title="Home">Over the line</a> <span class="welcome">that rug really tied the room together...</span></p>
            </div>
        </div>
    </header>

    <div class="splash">
        <div class="container">
            <ul>
                <li><a href="/">Home</a></li>
                    <li><a href="/about">whoami</a></li>
                    <li><a href="/rss">Rss Feed</a></li>
                <li><a href="http://axilleas.me/archives.html" title="Archive">Archive</a></li>
            </ul>
        </div>
    </div>

    <div class="container content">
<article>
    <header>
<h1><a href="/en/blog/2013/gitlab-gem-install-benchmarking-with-bundler-14" rel="bookmark">
    GitLab gem install benchmarking with bundler 1.4
</a></h1>
<time datetime="2013-08-31 00:00:00" pubdate>Posted on
    Sat 31 August 2013
</time>
<address class="vcard author">
    by <a class="url fn" href="http://axilleas.me/author/axil.html">
    axil</a>
</address>
<span class="category">in <a href="http://axilleas.me/category/linux.html">
    linux</a>.
        </span>
    </header>

    <div class="body">
        <p>It appears that the new <code>bundler 1.4.0</code> will <a href="https://github.com/bundler/bundler/pull/2481">support</a> parallel gem installation. Thanks to <a href="http://robots.thoughtbot.com/post/59584648154/parallel-gem-installing-using-bundler">thoughtbot's post</a>
that brought that to my attention :)</p>
<p>Now, since I've been dealing daily with GitLab for the past four months, I thought it would be a good candidate for testing.</p>
<p>I tried it on my production server which is a QEMU VM machine. Here are the specs<sup id="fnref:cpuinfo"><a class="footnote-ref" href="#fn:cpuinfo" rel="footnote">1</a></sup>:</p>
<div class="codehilite"><pre><span class="n">Operating</span> <span class="n">System</span>  <span class="o">:</span> <span class="n">Debian</span> <span class="mi">7</span>
<span class="n">Linux</span> <span class="n">kernel</span>      <span class="o">:</span> <span class="mf">3.2.0</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">amd64</span>
<span class="n">RAM</span>               <span class="o">:</span> <span class="mi">4</span><span class="n">GB</span>
<span class="n">CPU</span>               <span class="o">:</span> <span class="mi">4</span><span class="o">-</span><span class="n">cores</span>
</pre></div>


<p>On to the installation of bundler's <code>pre</code> version:</p>
<div class="codehilite"><pre><span class="n">gem</span> <span class="n">install</span> <span class="n">bundler</span> <span class="o">--</span><span class="n">pre</span>
</pre></div>


<p>Next step the actual benchmarking. Make sure you either perform a new GitLab installation or
remove the <code>vendor/bundle/</code> directory. I used the same command the official installation suggests:</p>
<div class="codehilite"><pre><span class="n">RAILS_ENV</span><span class="o">=</span><span class="n">production</span> <span class="n">bundle</span> <span class="n">install</span> <span class="o">--</span><span class="n">without</span> <span class="n">postgres</span> <span class="n">development</span> <span class="n">test</span> <span class="n">aws</span>
</pre></div>


<p>and I kept track of the output of four different numbers of jobs to run in parallel.
As you'll see, the recommended option is to use as many jobs as your cpu cores.</p>
<p>Next table depicts the difference in gem installation time which is pretty impressive.</p>
<table>
<thead>
<tr>
<th>#jobs</th>
<th align="left">time</th>
<th align="center">% difference</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 (default)</td>
<td align="left">281.91s user 47.21s system 39% cpu <strong>13:43.34</strong> total</td>
<td align="center">-</td>
</tr>
<tr>
<td>4</td>
<td align="left">286.28s user 48.60s system 104% cpu <strong>5:20.65</strong> total</td>
<td align="center">61 %</td>
</tr>
<tr>
<td>8</td>
<td align="left">267.65s user 43.41s system 128% cpu <strong>4:01.71</strong> total</td>
<td align="center">71 %</td>
</tr>
<tr>
<td>12</td>
<td align="left">262.71s user 42.90s system 136% cpu <strong>3:43.31</strong> total</td>
<td align="center">73 %</td>
</tr>
<tr>
<td>16</td>
<td align="left">256.37s user 41.47s system 139% cpu <strong>3:34.05</strong> total</td>
<td align="center">74 %</td>
</tr>
</tbody>
</table>
<div class="footnote">
<hr />
<ol>
<li id="fn:cpuinfo">
<p>See full <code>/proc/cpuinfo</code> in this <a href="https://gist.github.com/axilleas/6399274">gist</a>.&#160;<a class="footnote-backref" href="#fnref:cpuinfo" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
    </div>


    <div class="share">
        <a href="https://twitter.com/share" class="twitter-share-button"
           data-count="horizontal" data-text="GitLab gem install benchmarking with bundler 1.4"
           data-via="_axil">Tweet</a>
    </div>
    <script src="//platform.twitter.com/widgets.js"></script>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'kissmyarch'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>
    </div>

    <div class="container footnote">
        <a href="javascript:window.print();" title="Print">Print</a>
    </div>



    <footer>
        <div class="container footer">
            <span>Powered by <a href="http://docs.getpelican.com">
                Pelican</a> using <a href="https://github.com/BYK/pelican-neat">
                neat theme</a>. 
            </span>
            <nav>
                <ul>
                    <li><a href="https://github.com/axilleas/axilleas.github.io/tree/source" title="Source code">Source code</a></li>
                <li><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img
                    alt="Creative Commons License" src="http://i.creativecommons.org/l/by-nc-nd/3.0/80x15.png"></a></li>
                </ul>
            </nav>
        </div>
    </footer>
     <!-- Piwik -->
    <script type="text/javascript">
      var _paq = _paq || [];
      _paq.push(["trackPageView"]);
      _paq.push(["enableLinkTracking"]);

      (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://http://animal.foss.ntua.gr/~axil/stats//";
        _paq.push(["setTrackerUrl", u+"piwik.php"]);
        _paq.push(["setSiteId", "5"]);
        var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
        g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Piwik Code -->
</body>
</html>