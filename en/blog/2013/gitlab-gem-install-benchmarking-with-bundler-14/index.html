<!DOCTYPE html>
<html>
   <head>
   <meta charset="utf-8">
       <title>GitLab gem install benchmarking with bundler 1.4</title>
       <meta charset="utf-8" />
       <meta name="viewport" content="width=device-width, initial-scale=1.0" />
       <meta http-equiv="Pragma" content="no-cache" />
       <meta http-equiv="Expires" content="-1" />
       <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
       <link rel="stylesheet" href="/theme/css/friendly.css" type="text/css" />
       <link rel="stylesheet" href="/theme/css/print.css" type="text/css" media="print" />
       <link rel="stylesheet" type="text/css" href="/theme/tipuesearch/tipuesearch.css" media="screen">
       <link rel="stylesheet" href="/theme/css/font-awesome.min.css" type="text/css" />
       <link href="http://axilleas.me/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Over the line RSS Feed" />
</head>
<body>
   <header>
       <h1><a href="/" title="Mark it zero">Over the line</a></h1>
       <nav>
         <a href="/about" title="about me">whoami</a> &bull;
         <a href="/archives.html" title="Archives">Archives</a> &bull;
         <a id="subscribe-link" href="/rss" title="RSS feed" rel="nofollow">subscribe</a>
         <form id="searchform" action="/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
               <input id="searchbox" type="text" name="q" size="12" placeholder="Search">
         </form>
       </nav>
   </header>

   <div id="main">
<article>
    <header>
<h1><a href="/en/blog/2013/gitlab-gem-install-benchmarking-with-bundler-14" rel="bookmark">
    GitLab gem install benchmarking with bundler 1.4
</a></h1>
<span title="~227 words" id='stats'>~1 min read</span>
&bull;
<time datetime="2013-08-31 00:00:00+03:00" pubdate>Posted on
    Sat 31 August 2013
</time>
<span class="category">in <a href="/category/opensource.html">
    opensource</a>
</span>
    </header>

    <div class="body">
        <p>It appears that the new <code>bundler 1.4.0</code> will <a href="https://github.com/bundler/bundler/pull/2481">support</a> parallel gem installation. Thanks to <a href="http://robots.thoughtbot.com/post/59584648154/parallel-gem-installing-using-bundler">thoughtbot's post</a>
that brought that to my attention :)</p>
<p>Now, since I've been dealing daily with GitLab for the past four months, I thought it would be a good candidate for testing.</p>
<p>I tried it on my production server which is a QEMU VM machine. Here are the specs<sup id="fnref:cpuinfo"><a class="footnote-ref" href="#fn:cpuinfo" rel="footnote">1</a></sup>:</p>
<div class="codehilite"><pre>Operating System  : Debian 7
Linux kernel      : 3.2.0-4-amd64
RAM               : 4GB
CPU               : 4-cores
</pre></div>


<p>On to the installation of bundler's <code>pre</code> version:</p>
<div class="codehilite"><pre>gem install bundler --pre
</pre></div>


<p>Next step the actual benchmarking. Make sure you either perform a new GitLab installation or
remove the <code>vendor/bundle/</code> directory. I used the same command the official installation suggests:</p>
<div class="codehilite"><pre>RAILS_ENV=production bundle install --without postgres development test aws
</pre></div>


<p>and I kept track of the output of four different numbers of jobs to run in parallel.
As you'll see, the recommended option is to use as many jobs as your cpu cores.</p>
<p>Next table depicts the difference in gem installation time which is pretty impressive.</p>
<table>
<thead>
<tr>
<th>#jobs</th>
<th align="left">time</th>
<th align="center">% difference</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 (default)</td>
<td align="left">281.91s user 47.21s system 39% cpu <strong>13:43.34</strong> total</td>
<td align="center">-</td>
</tr>
<tr>
<td>4</td>
<td align="left">286.28s user 48.60s system 104% cpu <strong>5:20.65</strong> total</td>
<td align="center">61 %</td>
</tr>
<tr>
<td>8</td>
<td align="left">267.65s user 43.41s system 128% cpu <strong>4:01.71</strong> total</td>
<td align="center">71 %</td>
</tr>
<tr>
<td>12</td>
<td align="left">262.71s user 42.90s system 136% cpu <strong>3:43.31</strong> total</td>
<td align="center">73 %</td>
</tr>
<tr>
<td>16</td>
<td align="left">256.37s user 41.47s system 139% cpu <strong>3:34.05</strong> total</td>
<td align="center">74 %</td>
</tr>
</tbody>
</table>
<div class="footnote">
<hr />
<ol>
<li id="fn:cpuinfo">
<p>See full <code>/proc/cpuinfo</code> in this <a href="https://gist.github.com/axilleas/6399274">gist</a>.&#160;<a class="footnote-backref" href="#fnref:cpuinfo" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
    </div>

    <div class="neighbors"></div>

      <nav class="older">
          <a href="http://axilleas.me/en/blog/2013/gsoc-weekly-update-9-and-10">
              <span class="lpin"></span>
              GSoC - Weekly update 9 and 10
          </a>
      </nav>

      <nav class="newer">
          <a href="http://axilleas.me/en/blog/2013/gsoc-weekly-update-11-and-12">
              GSoC - Weekly update 11 and 12
              <span class="rpin"></span>
          </a>
      </nav>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'kissmyarch';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></article>
   </div>

   <footer>
       <p>Powered by <a href="http://docs.getpelican.com">
           Pelican</a> using <a href="https://github.com/axilleas/pelican-uberspot">uberspot theme</a> &bull;
         Background image from <a href="http://subtlepatterns.com/">Subtle patterns</a> &bull;
               <a href="https://github.com/axilleas/axilleas.github.io/tree/source" title="Source code">Source code</a>
</p>


 <p><a id="cc-logo" title="Creative Commons License"
 rel="license" href="http://creativecommons.org/licenses/by/4.0/"></a>
 Except where otherwise noted, content on this site is licensed under a<br />
 <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>

   </footer>
     <!-- Piwik -->
    <script type="text/javascript">
      var _paq = _paq || [];
      _paq.push(["trackPageView"]);
      _paq.push(["enableLinkTracking"]);

      (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://piwik2-glb.rhcloud.com/";
        _paq.push(["setTrackerUrl", u+"piwik.php"]);
        _paq.push(["setSiteId", "5"]);
        var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
        g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Piwik Code -->
</body>
</html>