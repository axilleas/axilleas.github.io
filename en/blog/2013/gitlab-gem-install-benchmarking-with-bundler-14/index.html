<!DOCTYPE html>
<html lang="en">
<head>



</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://axilleas.me">Over the line <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="http://axilleas.me/about">whoami</a></li>
            <li><a href="http://axilleas.me/rss">Rss Feed</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="http://axilleas.me/en/blog/2013/gitlab-gem-install-benchmarking-with-bundler-14" rel="bookmark"
         title="Permalink to GitLab gem install benchmarking with bundler 1.4">GitLab gem install benchmarking with bundler 1.4</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2013-08-31T00:00:00">
      Sat 31 August 2013
    </abbr>
    <address class="vcard author">
      By <a class="url fn" href="http://axilleas.me/author/axil.html">axil</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>It appears that the new <code>bundler 1.4.0</code> will <a href="https://github.com/bundler/bundler/pull/2481">support</a> parallel gem installation. Thanks to <a href="http://robots.thoughtbot.com/post/59584648154/parallel-gem-installing-using-bundler">thoughtbot's post</a>
that brought that to my attention :)</p>
<p>Now, since I've been dealing daily with GitLab for the past four months, I thought it would be a good candidate for testing.</p>
<p>I tried it on my production server which is a QEMU VM machine. Here are the specs<sup id="fnref:cpuinfo"><a class="footnote-ref" href="#fn:cpuinfo" rel="footnote">1</a></sup>:</p>
<div class="codehilite"><pre><span class="n">Operating</span> <span class="n">System</span>  <span class="o">:</span> <span class="n">Debian</span> <span class="mi">7</span>
<span class="n">Linux</span> <span class="n">kernel</span>      <span class="o">:</span> <span class="mf">3.2.0</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">amd64</span>
<span class="n">RAM</span>               <span class="o">:</span> <span class="mi">4</span><span class="n">GB</span>
<span class="n">CPU</span>               <span class="o">:</span> <span class="mi">4</span><span class="o">-</span><span class="n">cores</span>
</pre></div>


<p>On to the installation of bundler's <code>pre</code> version:</p>
<div class="codehilite"><pre><span class="n">gem</span> <span class="n">install</span> <span class="n">bundler</span> <span class="o">--</span><span class="n">pre</span>
</pre></div>


<p>Next step the actual benchmarking. Make sure you either perform a new GitLab installation or
remove the <code>vendor/bundle/</code> directory. I used the same command the official installation suggests:</p>
<div class="codehilite"><pre><span class="n">RAILS_ENV</span><span class="o">=</span><span class="n">production</span> <span class="n">bundle</span> <span class="n">install</span> <span class="o">--</span><span class="n">without</span> <span class="n">postgres</span> <span class="n">development</span> <span class="n">test</span> <span class="n">aws</span>
</pre></div>


<p>and I kept track of the output of four different numbers of jobs to run in parallel.
As you'll see, the recommended option is to use as many jobs as your cpu cores.</p>
<p>Next table depicts the difference in gem installation time which is pretty impressive.</p>
<table>
<thead>
<tr>
<th>#jobs</th>
<th align="left">time</th>
<th align="center">% difference</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 (default)</td>
<td align="left">281.91s user 47.21s system 39% cpu <strong>13:43.34</strong> total</td>
<td align="center">-</td>
</tr>
<tr>
<td>4</td>
<td align="left">286.28s user 48.60s system 104% cpu <strong>5:20.65</strong> total</td>
<td align="center">61 %</td>
</tr>
<tr>
<td>8</td>
<td align="left">267.65s user 43.41s system 128% cpu <strong>4:01.71</strong> total</td>
<td align="center">71 %</td>
</tr>
<tr>
<td>12</td>
<td align="left">262.71s user 42.90s system 136% cpu <strong>3:43.31</strong> total</td>
<td align="center">73 %</td>
</tr>
<tr>
<td>16</td>
<td align="left">256.37s user 41.47s system 139% cpu <strong>3:34.05</strong> total</td>
<td align="center">74 %</td>
</tr>
</tbody>
</table>
<div class="footnote">
<hr />
<ol>
<li id="fn:cpuinfo">
<p>See full <code>/proc/cpuinfo</code> in this <a href="https://gist.github.com/axilleas/6399274">gist</a>.&#160;<a class="footnote-backref" href="#fnref:cpuinfo" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>